{% extends "base.html" %}

{% block title %}Lifetime - {{ app_title }}{% endblock %}

{% block content %}
<section class="panel">
  <h2>All Games Summary</h2>
  <p class="muted">Aggregated stats across all matches. Filters apply to the totals.</p>

  <form class="filters" method="get">
    <label>
      Player
      <select name="player">
        <option value="all" {% if selected_player == 'all' %}selected{% endif %}>All</option>
        {% for player in players %}
        <option value="{{ player }}" {% if selected_player == player %}selected{% endif %}>{{ player }}</option>
        {% endfor %}
      </select>
    </label>
    <label>
      Playlist
      <select name="playlist">
        <option value="all" {% if selected_playlist == 'all' %}selected{% endif %}>All</option>
        {% for playlist in playlists %}
        <option value="{{ playlist }}" {% if selected_playlist == playlist %}selected{% endif %}>{{ playlist }}</option>
        {% endfor %}
      </select>
    </label>
    <label>
      Mode
      <select name="mode">
        <option value="all" {% if selected_mode == 'all' %}selected{% endif %}>All</option>
        {% for mode in modes %}
        <option value="{{ mode }}" {% if selected_mode == mode %}selected{% endif %}>{{ mode }}</option>
        {% endfor %}
      </select>
    </label>
    <label>
      Limit
      <select name="limit">
        <option value="all" {% if selected_limit == 'all' %}selected{% endif %}>All</option>
        {% for value in [25, 50, 100, 200, 500, 1000, 2000] %}
        <option value="{{ value }}" {% if selected_limit == value %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit" class="btn">Filter</button>
  </form>

  <div class="table-wrap">
    <table class="data-table" data-table="lifetime-summary">
      <thead>
        <tr>
          <th>Player</th>
          <th>Matches</th>
          <th>Wins</th>
          <th>Losses</th>
          <th>Win Rate</th>
          <th>Kills</th>
          <th>Deaths</th>
          <th>Assists</th>
          <th>KDA</th>
          <th>Accuracy</th>
          <th>Avg Score</th>
          <th>Avg Obj Score</th>
        </tr>
      </thead>
      <tbody>
        {% if lifetime_rows %}
        {% for row in lifetime_rows %}
        <tr>
          <td><span class="player-name {{ row.player|player_class }}">{{ row.player }}</span></td>
          <td class="{{ row.matches_heat }}">{{ row.matches }}</td>
          <td class="{{ row.wins_heat }}">{{ row.wins }}</td>
          <td class="{{ row.losses_heat }}">{{ row.losses }}</td>
          <td class="{{ row.win_rate_heat }}">{{ row.win_rate }}</td>
          <td class="{{ row.kills_heat }}">{{ row.kills }}</td>
          <td class="{{ row.deaths_heat }}">{{ row.deaths }}</td>
          <td class="{{ row.assists_heat }}">{{ row.assists }}</td>
          <td class="{{ row.kda_heat }}">{{ row.kda }}</td>
          <td class="{{ row.accuracy_heat }}">{{ row.accuracy }}</td>
          <td class="{{ row.avg_score_heat }}">{{ row.avg_score }}</td>
          <td class="{{ row.avg_obj_score_heat }}">{{ row.avg_obj_score }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="12" class="empty">No data yet</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>

<section class="panel">
  <h2>All Games</h2>
  <p class="muted">Most recent matches for the selected filters.</p>

  <div class="table-wrap">
    <table class="data-table" data-table="session" style="min-width: 2200px;">
      <thead>
        <tr>
          <th>Date</th>
          <th>Player</th>
          <th>Mode</th>
          <th>Map</th>
          <th>Playlist</th>
          <th>Outcome</th>
          <th>K</th>
          <th>D</th>
          <th>A</th>
          <th>KDA</th>
          <th title="Kill/Death ratio">KD</th>
          <th title="Damage dealt">DMG+</th>
          <th title="Damage taken">DMG-</th>
          <th title="Damage difference">DMG I"</th>
          <th title="Shots fired">Fired</th>
          <th title="Shots landed">Landed</th>
          <th>Accuracy</th>
          <th>Score</th>
          <th title="Objective score (personal score minus combat bonuses)">Obj Score</th>
          <th title="Medal count">Medals</th>
          <th title="Average life duration">Life</th>
          <th title="Headshots">HS</th>
          <th title="Melee kills">Melee</th>
          <th title="Grenade kills">Grenade</th>
          <th title="Power weapon kills">Power</th>
          <th title="Callout assists">Callouts</th>
        </tr>
      </thead>
      <tbody>
        {% if session_rows %}
        {% for row in session_rows %}
        <tr>
          <td>{{ row.date }}</td>
          <td><span class="player-name {{ row.player|player_class }}">{{ row.player }}</span></td>
          <td>{{ row.game_type }}</td>
          <td>{{ row.map }}</td>
          <td>{{ row.playlist }}</td>
          <td><span class="pill {{ row.outcome_class }}">{{ row.outcome }}</span></td>
          <td class="{{ row.kills_heat }}">{{ row.kills }}</td>
          <td class="{{ row.deaths_heat }}">{{ row.deaths }}</td>
          <td class="{{ row.assists_heat }}">{{ row.assists }}</td>
          <td class="{{ row.kda_heat }}">{{ row.kda }}</td>
          <td class="{{ row.kd_heat }}">{{ row.kd }}</td>
          <td class="{{ row.damage_dealt_heat }}">{{ row.damage_dealt }}</td>
          <td class="{{ row.damage_taken_heat }}">{{ row.damage_taken }}</td>
          <td class="{{ row.damage_diff_heat }}">{{ row.damage_diff }}</td>
          <td>{{ row.shots_fired }}</td>
          <td>{{ row.shots_landed }}</td>
          <td class="{{ row.accuracy_heat }}">{{ row.accuracy }}</td>
          <td class="{{ row.score_heat }}">{{ row.score }}</td>
          <td class="{{ row.obj_score_heat }}">{{ row.obj_score }}</td>
          <td class="{{ row.medals_heat }}">{{ row.medals }}</td>
          <td class="{{ row.avg_life_heat }}">{{ row.avg_life }}</td>
          <td class="{{ row.headshots_heat }}">{{ row.headshots }}</td>
          <td class="{{ row.melee_heat }}">{{ row.melee }}</td>
          <td class="{{ row.grenade_heat }}">{{ row.grenade }}</td>
          <td class="{{ row.power_heat }}">{{ row.power }}</td>
          <td class="{{ row.callouts_heat }}">{{ row.callouts }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="26" class="empty">No data yet</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
